#!/usr/bin/env ruby

require "bundler/setup"
require "retest"
require "byebug"

$stdout.sync = true

options = Retest::Options.new(ARGV)

if options.help?
  $stdout.puts options.help
  return
end

runner     = Retest::Runner.for(options.command)
repository = Retest::Repository.new(files: Retest::VersionControl.files)

if options.params[:diff]
  Retest.diff(runner: runner, repository: repository, branch: options.params[:diff])
else
  Retest.start(runner: runner, repository: repository) # not blocking
  sleep
end
