#!/usr/bin/env ruby

require "bundler/setup"
require "retest"
require "byebug"

$stdout.sync = true

options = Retest::Options.new(ARGV)

if options.help?
  $stdout.puts options.help
  return
end

repository = Retest::Repository.new(files: Retest::VersionControl.files)
command    = Retest::Command.for_options(options)
runner     = Retest::Runner.for(command.to_s)

program = Retest::Program.new(
  extension: options.extension,
  repository: repository,
  command: command,
  runner: runner
)

if options.params[:diff]
  program.diff(options.params[:diff])
else
  program.start # not blocking
  sleep
end
